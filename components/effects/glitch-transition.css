/* Spectrum Chromatic Separation Transition */

/* Mobile: Simple fade transition */
.mobile-fade-active {
  animation: mobile-fade 0.3s ease-in-out;
}

@keyframes mobile-fade {
  0% {
    opacity: 0.85;
  }

  100% {
    opacity: 1;
  }
}

/* Desktop Only: Full Spectrum Effects (â‰¥1024px) */
@media (min-width: 1024px) {

  /* Container doesn't animate, just needs to not clip */
  .glitch-active {
    transform-style: preserve-3d;
  }

  /* 
     Apply spectrum separation to text elements.
     Using text-shadow is performant for typography.
  */
  .glitch-active h1,
  .glitch-active h2,
  .glitch-active h3,
  .glitch-active p,
  .glitch-active span,
  .glitch-active a,
  .glitch-active button {
    animation: spectrum-text 0.75s cubic-bezier(0.2, 0.0, 0.2, 1) forwards;
    will-change: text-shadow, transform;
    transform: translateZ(0);
    /* Force layer promotion */
    backface-visibility: hidden;
  }

  /* 
     Apply spectrum separation to blocks/images/containers.
     Using filter: drop-shadow is more expensive but works on non-text.
     Plus Ramping Pixelation (Block Distortion) 
  */
  .glitch-active img,
  .glitch-active svg,
  .glitch-active .card-content,
  .glitch-active-particles {
    animation:
      spectrum-block 0.75s cubic-bezier(0.2, 0.0, 0.2, 1) forwards,
      pixelate-ramp 0.75s steps(2) forwards;
    /* Steps creates the 'block' feel */
    will-change: filter, transform, clip-path;
    transform: translateZ(0);
    /* Force layer promotion */
    backface-visibility: hidden;
  }

  @keyframes spectrum-text {
    0% {
      text-shadow: 0 0 transparent;
      opacity: 1;
      transform: scale(1) translateZ(0);
    }

    50% {
      /* Peak separation - Intensified 3x */
      text-shadow:
        -12px 0 rgba(255, 0, 0, 0.5),
        /* Red Left */
        12px 0 rgba(0, 255, 255, 0.5),
        /* Cyan Right */
        -6px 0 rgba(0, 255, 0, 0.3),
        /* Green subtle left */
        6px 0 rgba(0, 0, 255, 0.3);
      /* Blue subtle right */
      opacity: 0.8;
      transform: scale(1.02) translateZ(0);
      /* Slight pulse */
      filter: blur(1px);
    }

    100% {
      text-shadow: 0 0 transparent;
      opacity: 1;
      transform: scale(1) translateZ(0);
      filter: none;
    }
  }

  @keyframes spectrum-block {
    0% {
      filter: drop-shadow(0 0 0 transparent);
      transform: translate3d(0, 0, 0);
    }

    50% {
      /* Peak separation for blocks - Intensified 3x */
      filter:
        drop-shadow(-12px 0 0 rgba(255, 0, 0, 0.4)) drop-shadow(12px 0 0 rgba(0, 255, 255, 0.4));
      transform: translate3d(0, 0, 0);
    }

    100% {
      filter: drop-shadow(0 0 0 transparent);
      transform: translate3d(0, 0, 0);
    }
  }

  /* Ramping Pixelation / Block Distortion */
  @keyframes pixelate-ramp {
    0% {
      clip-path: inset(0 0 0 0);
    }

    10% {
      clip-path: inset(10% 0 10% 0);
      /* Gentle trim */
    }

    30% {
      clip-path: inset(30% 0 40% 0);
      /* Heavy block cut */
    }

    50% {
      clip-path: inset(40% 0 40% 0);
      /* Peak blockiness (narrow strip) */
    }

    70% {
      clip-path: inset(30% 0 20% 0);
      /* Reversing */
    }

    90% {
      clip-path: inset(10% 0 5% 0);
    }

    100% {
      clip-path: inset(0 0 0 0);
    }
  }

  /* EXCLUSION RULE: Prevent spectrum effects on specific containers */
  .glitch-active .spectrum-immune,
  .glitch-active .spectrum-immune * {
    animation: none !important;
    transform: none !important;
    filter: none !important;
    opacity: 1 !important;
    text-shadow: none !important;
    clip-path: none !important;
  }
}